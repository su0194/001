<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¬¬ä¸€é—œï¼šæ—¥æœ¬</title>
  <style>
    @font-face {
      font-family: "ç‹æ¼¢å®—é‹¼ç²—é«”æ¨™æº–";
      src: url("fonts/wcl-07.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }
    body, button, h1, h2, h3, p, div {
      font-family: "ç‹æ¼¢å®—é‹¼ç²—é«”æ¨™æº–", Arial, sans-serif;
    }
    body {
      margin: 0;
      background: url('images/bg_japan.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .game-container {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      max-width: 800px;
      margin: 30px auto;
      border-radius: 10px;
    }
    .instructions p {
      margin: 5px 0;
    }
    .score-board {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .flag {
      width: 60px;
      height: auto;
    }
    .progress-bar-bg {
      width: 60%;
      height: 20px;
      background-color: #444;
      margin: 0 15px;
      border-radius: 10px;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background-color: #4caf50;
      border-radius: 10px;
    }
    .note-area {
      height: 300px;
      background: rgba(255, 255, 255, 0.1);
      margin-top: 20px;
      position: relative;
      overflow: hidden;
    }
    .note {
      width: 50px;
      height: 50px;
      background: yellow;
      position: absolute;
      top: -60px;
      animation: drop 3s linear forwards;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 24px;
      color: black;
      border-radius: 6px;
      user-select: none;
    }
    @keyframes drop {
      to { top: 280px; }
    }
    .feedback {
      font-size: 2em;
      text-align: center;
      height: 50px;
    }
    .flash {
      animation: flashRed 0.3s;
    }
    @keyframes flashRed {
      from { background-color: rgba(255, 0, 0, 0.5); }
      to { background-color: transparent; }
    }
    #start-btn {
      display: block;
      margin: 20px auto;
      padding: 12px 30px;
      font-size: 1.5em;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #start-btn:hover {
      background-color: #45a049;
    }
    #game-content {
      display: none;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>SDGs ç¬¬17é … - å¤¥ä¼´é—œä¿‚ï¼šæ—‹å¾‹ç¯€å¥éŠæˆ²</h1>

    <div id="intro">
      <p>ğŸ® éŠæˆ²ç©æ³•ï¼šç•¶ç¯€å¥éŸ³ç¬¦ä¸‹è½è‡³åˆ¤å®šå€æ™‚ï¼ŒæŒ‰ä¸‹å°æ‡‰æŒ‰éµï¼ˆAã€Sã€Dã€Jã€Kã€Lï¼‰ã€‚</p>
      <p>âœ… æŒ‰å°é¡¯ç¤ºã€ŒPerfectã€ï¼Œå¾— 2 åˆ†ï¼›âŒ æŒ‰éŒ¯è¢å¹•è®Šç´…ï¼Œæ‰£ 1 åˆ†ã€‚</p>
      <p>ğŸ¯ åˆ†æ•¸é” 30 åˆ†éé—œï¼Œæœªé”å°‡é‡æ–°é–‹å§‹ã€‚</p>
      <p>ğŸŒ SDGs ç¬¬17é …å¼·èª¿å…¨çƒåˆä½œèˆ‡å¤¥ä¼´é—œä¿‚ã€‚æ¯éä¸€é—œï¼Œå°±ä»£è¡¨ä½ æˆåŠŸä¿ƒæˆä¸€å€‹æ–°çš„é‚¦äº¤åœ‹åŠ å…¥åˆä½œï¼Œå¯¦è¸å…¨çƒå¤¥ä¼´è¡Œå‹•ï¼</p>
      <button id="start-btn">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-content">
      <div class="score-board">
        <span>åˆ†æ•¸ï¼š<span id="score">0</span></span>
        <div class="progress-bar-bg">
          <div class="progress-bar" id="progress"></div>
        </div>
        <img src="images/japan.png" class="flag" alt="æ—¥æœ¬åœ‹æ——" />
      </div>

      <div class="note-area" id="note-area"></div>
      <div class="feedback" id="feedback"></div>
    </div>
  </div>

  <audio id="bgm" src="audio/bgm_japan.mp3" volume="0.2"></audio>

  <script>
    const bgm = document.getElementById('bgm');
    const noteArea = document.getElementById('note-area');
    const feedback = document.getElementById('feedback');
    const scoreDisplay = document.getElementById('score');
    const progressBar = document.getElementById('progress');

    const startBtn = document.getElementById('start-btn');
    const intro = document.getElementById('intro');
    const gameContent = document.getElementById('game-content');

    let score = 0;
    const targetScore = 30;
    const totalNotes = 20;
    let notesHit = 0;
    let gameInterval = null;

    function showFeedback(text, color) {
      feedback.textContent = text;
      feedback.style.color = color;
    }

    function flashRed() {
      document.body.classList.add('flash');
      setTimeout(() => document.body.classList.remove('flash'), 300);
    }

    function createNote() {
      const keys = ["A", "S", "D", "J", "K", "L"];
      const key = keys[Math.floor(Math.random() * keys.length)];

      const note = document.createElement('div');
      note.classList.add('note');
      note.textContent = key;
      note.style.left = `${Math.random() * 90 + 5}%`;
      note.dataset.key = key; // è¨˜éŒ„è©²éŸ³ç¬¦æ‡‰æŒ‰çš„éµ
      noteArea.appendChild(note);

      setTimeout(() => {
        // éŸ³ç¬¦æ¶ˆå¤±æ™‚ï¼Œè‹¥æœªè¢«æŒ‰å‰‡æ‰£åˆ†
        if (note.parentElement) {
          note.remove();
          score -= 1;
          showFeedback('Miss', 'red');
          flashRed();
          scoreDisplay.textContent = score;
          updateProgress();
        }
      }, 3000);
    }

    function updateProgress() {
      const percentage = Math.min(score / targetScore * 100, 100);
      progressBar.style.width = `${percentage}%`;
    }

    function startGame() {
      intro.style.display = 'none';
      gameContent.style.display = 'block';
      bgm.volume = 0.2;
      bgm.play();

      score = 0;
      notesHit = 0;
      scoreDisplay.textContent = score;
      updateProgress();

      gameInterval = setInterval(createNote, 2000);
    }

    document.addEventListener('keydown', (e) => {
      if (gameContent.style.display === 'none') return; // éŠæˆ²æ²’é–‹å§‹ä¸è™•ç†æŒ‰éµ

      const keyPressed = e.key.toUpperCase();
      const allowedKeys = ["A", "S", "D", "J", "K", "L"];
      if (!allowedKeys.includes(keyPressed)) return;

      // æ‰¾ç¬¬ä¸€å€‹éŸ³ç¬¦ï¼Œä¸”æŒ‰éµå»åˆæ‰ç®—å‘½ä¸­
      const note = document.querySelector('.note');
      if (note && note.dataset.key === keyPressed) {
        note.remove();
        score += 2;
        notesHit++;
        showFeedback('Perfect', 'lightgreen');
      } else {
        score -= 1;
        showFeedback('Miss', 'red');
        flashRed();
      }

      scoreDisplay.textContent = score;
      updateProgress();

      if (notesHit >= totalNotes) {
        clearInterval(gameInterval);
        bgm.pause();

        if (score >= targetScore) {
          // æˆå°±ç´€éŒ„å¯«å…¥ localStorage
          localStorage.setItem('ach_japan_level1_cleared', 'true');

          showFeedback('æ­å–œéé—œï¼', 'lightgreen');  // é¡¯ç¤ºéé—œæ–‡å­—
          setTimeout(() => {
            window.location.href = 'games_2.html';
          }, 1000);  // 1ç§’å¾Œè·³è½‰
        } else {
          setTimeout(() => {
            alert('åˆ†æ•¸æœªé”30åˆ†ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼');
            window.location.reload();
          }, 100);
        }
      }
    });

    startBtn.addEventListener('click', startGame);
  </script>
</body>
</html>
